stages:
  - secret-detection
  - health-check

variables:
  SECRET_DETECTION_ENABLED: "true"

secret_detection:
  stage: secret-detection

services_health_check:
  stage: health-check
  tags:
    - anngu
  image: ubuntu:latest
  before_script:
    - apt-get update -qq
    - apt-get install -y netcat-openbsd curl
  script:
    - ./scripts/health-check.sh
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
    - when: manual
  allow_failure: false
  timeout: 5 minutes

include:
  - template: Security/Secret-Detection.gitlab-ci.yml
